import sys

$PATH.append("/home/infinitecoder/.dotfiles/xonsh/venv/bin")
$PATH.append("/home/infinitecoder/.cargo/bin")
$XONSH_HISTORY_BACKEND = 'sqlite'

from xonsh.tools import register_custom_style
register_custom_style("fixed", {
    "BACKGROUND_INTENSE_BLACK": "#000000",
}, base="default")
$XONSH_COLOR_STYLE="fixed"

$EDITOR = "hx"
$VISUAL = $EDITOR
$SHELL = "xonsh" # Fix nix develop

$fzf_history_binding = "c-r"
$fzf_ssh_binding = "c-s"
$fzf_file_binding = "c-t"
$fzf_dir_binding = "c-g"

xontrib load vox
xontrib load fzf-completions
xontrib load readable-traceback

execx($(starship init xonsh))
execx($(zoxide init xonsh), 'exec', __xonsh__.ctx, filename='zoxide')
execx($(any-nix-shell xonsh --info-right))

$TITLE = "{cwd_base}"

def _y(args):
    tmp = $(mktemp -t "yazi-cwd.XXXXXX")
    args.append(f"--cwd-file={tmp}")
    $[yazi @(args)]
    with open(tmp) as f:
        cwd = f.read().strip()
    if cwd and cwd != $PWD:
        cd @(cwd)
    rm -f -- @(tmp)

aliases["y"] = _y
aliases['flake-new'] = 'wget https://gist.githubusercontent.com/InfiniteCoder01/e3b8f14405114a7cff1618d807612545/raw/flake.nix -O flake.nix'

aliases['x'] = 'eza --icons always'
aliases['xa'] = 'eza --icons always --all'
aliases['xl'] = 'eza --icons always --long'
aliases['xla'] = 'eza --icons always --long --all'
aliases['xt'] = 'eza --icons always --tree'
aliases['xta'] = 'eza --icons always --tree --all'
aliases['shh'] = '(@($args) all>/dev/null &)'
